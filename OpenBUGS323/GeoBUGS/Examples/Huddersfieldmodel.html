<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Huddersfieldmodel</title></head><body><p><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">model {<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Likelihood</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#FF0000" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">for (i in 1 : I) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># convolution likelihood: <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Y[i] ~ Poisson( sum_ j { mu[i, j] } )<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># where mu[i, j] = pop[i] * lambda[i, j] and<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># pop[i] = (standardised) population (in 100's) in area i<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># lambda[i, j] = disease rate in area i attributed to jth 'source', where<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># the sources include both observed and latent covariates.<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i] ~ dpois.conv(mu[i, ])&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="1"></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for (j in 1 : J) { <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># rescale kernel matrix<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k1[i, j] &lt;- ker[i, j] / prec<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</font><font face="Arial" color="#000100" size="3"> jth 'source' (jth latent spatial grid cell)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">lambda[i, j] &lt;- beta2 * gamma[j] * k1[i, j]</font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;}<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># (J+1)th 'source' (overall intercept; represents background rate)</font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">lambda[i,J+1] &lt;- beta0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (J+2)th 'source' (effect of observed NO2 covariate in area i)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">&nbsp;&nbsp;&nbsp;lambda[i,J+2] &lt;- beta1 * NO2[i]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># Note: if additional covariates have been measured, these <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># should be included in the same way as NO2, giving terms<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># lambda[i, J+3], lambda[i, J+4],.....etc. </font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for (j in 1 : J+2) { </font><font face="Arial" color="#000000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu[i, j] &lt;- lambda[i, j] * pop[i]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">}<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">}<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Priors</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># See Table 22.1 in Best et al. (2000b) for further details.<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># Priors for latent spatial grid cell (gamma) parameters:<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Assume gamma_j ~ gamma(a, t) <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Prior shape parameter for gamma distn on gamma[j]'s will change in proportion to<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the size of the latent grid cells, to ensure aggregation consistency. The prior inverse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# scale parameter for gamma distn on gamma[j]'s stays constant across different<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# partitions, but depends on the units used to measure the area of the latent grid cells:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# here we are assuming # 'area' is in sq kilometres, and we take tauG = 1 (per km^2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# which corresponds to assuming # that our prior guess at the value of the gamma[j]'s<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is based on 'observing' about 1 * (area of study region = 30*20km^2) = 600<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># 'prior points' over the study region. </font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note: area of latent grid cells is read in from data file<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alphaG &lt;- tauG * area<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tauG &lt;- 1 <br></font><font face="Arial" color="#000100" size="1"></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for (j in 1 : J) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gamma[j] ~ dgamma(alphaG, tauG)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;}<br></font><font face="Arial" color="#000000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># Priors for beta coefficients:<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3">#<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Assume priors on each beta are of the form beta ~ gamma(a, t).<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3">#<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Here, parameter of the prior are chosen by setting the prior mean to give an equal <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># number of cases allocated to each of the 3 'sources' (baseline, NO2 and latent), i.e.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# prior mean = a / t = a * 3 * Xbar / Ybar,<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># where Ybar is the overall disease rate in number of cases per unit population,<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># and Xbar is the </font><font face="Arial" color="#808080" size="3"><strong>population-weighted mean</strong></font><font face="Arial" color="#808080" size="3"> of covariate X. <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># We also take shape parameter a = 0.575, since this gives the ratio of the 90th : 10th<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># percentile of the prior distn = 100, which is suitably diffuse.<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;YBAR &lt;- sum(Y[])/sum(pop[])&nbsp;&nbsp;&nbsp;# mean number of cases per unit population<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;NO2BAR &lt;- inprod(NO2[], pop[]) / sum(pop[])&nbsp;&nbsp;&nbsp;# population-weighted mean NO2<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Shape parameter for Intercept (beta0)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alpha0&lt;- 0.575<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Inverse scale parameter for Intercept (beta0)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tau0 &lt;- 3 * alpha0 / YBAR<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Shape parameter for effect of NO2 (beta1)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alpha1&lt;- 0.575<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Inverse scale parameter for effect of NO2 (beta1)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tau1 &lt;- 3 * alpha1 * NO2BAR / YBAR<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Shape parameter for Latent coefficient (beta2)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alpha2 &lt;- 0.575<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Inverse scale parameter for Latent coefficient (beta2)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tau2 &lt;- 3 * alpha2&nbsp;&nbsp;&nbsp;/ YBAR<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;beta0 ~ dgamma(alpha0, tau0)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;beta1 ~ dgamma(alpha1, tau1)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;beta2 ~ dgamma(alpha2, tau2)<br><br></font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Summary quantities for posterior inference </font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#FF0000" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">for(i in 1:I) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Overall disease rate in area i <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RATE[i] &lt;- sum(mu[i, ])/pop[i]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Rate associated with latent spatial factor in area i <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LATENT[i] &lt;- beta2 * inprod(k1[i,], gamma[])<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;}<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Expected rate (number of cases per unit population) attributed to each source <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># (see Table 22.2 in Best et al (2000b) )<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Background (overall baseline) rate per 100 population<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">rate.base &lt;- beta0<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Number of cases per 100 population attributed<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># to NO2 = beta1 * population-weighted mean value<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># of NO2 across the study region. <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;rate.no2 &lt;- beta1 * inprod(pop[], NO2[]) / sum(pop[])<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Number of cases per 100 population attributed to <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># latent sources = beta2 * population-weighted mean<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># value of the latent spatial factor (sum_j k_ij gamma_j)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;rate.latent &lt;- inprod(pop[], LATENT[]) / sum(pop[])<br></font><font face="Arial" color="#000100" size="1"></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Percentage of cases attributed to each source:<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;Total &lt;- rate.base + rate.no2 + rate.latent </font><font face="Arial" color="#0000FF" size="3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># % cases attributed to baseline risk</font><font face="Arial" color="#0000FF" size="3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">PC.base &lt;- rate.base / Total * 100<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# % cases attributed to NO2 exposure<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;PC.no2 &lt;- rate.no2 / Total * 100<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# % cases attributed to latent spatial factors<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;PC.latent &lt;- rate.latent / Total * 100<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">}<br></font></p></body></html>