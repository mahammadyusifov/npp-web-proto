<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd"><html><head><title>Huddersfield</title></head><body><p><font face="Arial" color="#000100" size="2"><img src="huddersfield0.bmp" alt="[huddersfield0]">&nbsp;&nbsp;&nbsp;</font><font face="Courier New" color="#000100" size="6">Poisson-gamma spatial moving<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;average (convolution)model:&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ecological regression of air<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pollution and respiratory<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;illness in children</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3"><br>Best et al (2000b) applied the Poisson-gamma convolution model to a small-area ecological regression analysis of traffic-related air pollution and respiratory illness in children living in the Huddersfield region of northern England. They carried out two analyses, one using a partition of the study region into 427 administrative enumeration districts, and the other partitioning the region into 605 regular 750m</font><font face="Arial" color="#000100" size="2"><sup>2</sup></font><font face="Arial" color="#000100" size="3"> grid cells. Here we consider the latter partition of the study region. The following data were available:<br><br>Y</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> = number of cases of self-reported frequent cough amongst children aged 7-9 in each of the i=1,..., 605 areas (750 m</font><font face="Arial" color="#000100" size="2"><sup>2</sup></font><font face="Arial" color="#000100" size="3"> grid cells)<br>pop</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> = (estimated) population of 7-9 year old children in each area, based on pro-rated 1991 enumeration district census counts. (Note that this leads to &lt;1 child per area in some areas, due to the pro-rata split; counts are also divided by 100, to give rates per 100 children).<br>NO2</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">= </font><font face="Arial" color="#000000" size="3">average annual nitrogen dioxide concentration in each area, measured in </font><font face="Symbol" color="#000000" size="3">m</font><font face="Arial" color="#000000" size="3">g m</font><font face="Arial" color="#000000" size="2"><sup>-3</sup></font><font face="Arial" color="#000000" size="3"> above the baseline concentration for the study region of approximately 20</font><font face="Symbol" color="#000000" size="3">m</font><font face="Arial" color="#000000" size="3">g m</font><font face="Arial" color="#000000" size="2"><sup>-3</sup></font><font face="Arial" color="#000000" size="3"><sup><br></sup></font><font face="Arial" color="#000100" size="3"><br>Best et al (2000b) fitted an indentity-link spatial moving average Poisson regression model:<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;Y</font><font face="Arial" color="#000100" size="2"><sub>i </sub></font><font face="Arial" color="#000100" size="3">~ Poisson( </font><font face="Symbol" color="#000100" size="3">m</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="3">&nbsp;&nbsp;&nbsp;m</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">= pop</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> * </font><font face="Symbol" color="#000100" size="3">l</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"> </font><font face="Symbol" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Symbol" color="#000100" size="3">&nbsp;&nbsp;&nbsp;l</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">= </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3"> + </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>1</sub></font><font face="Arial" color="#000100" size="3"> NO2</font><font face="Arial" color="#000100" size="2"><sub>i</sub></font><font face="Arial" color="#000100" size="3"><sub> </sub></font><font face="Arial" color="#000100" size="3">+ </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>2</sub></font><font face="Arial" color="#000100" size="3"> </font><font face="Symbol" color="#000100" size="3">S</font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"> k</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> </font><font face="Symbol" color="#000100" size="3">g</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#0000FF" size="3"><br></font><font face="Arial" color="#000100" size="3">where</font><font face="Arial" color="#0000FF" size="3"> </font><font face="Symbol" color="#000100" size="3">g</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>j </sub></font><font face="Arial" color="#000100" size="3">can be thought of as latent unobserved risk factors associated with locations or sub-regions of the study region indexed by j. These locations or sub-regions are typically defined by the user, and are chosen to represent a partition of the region that is appropriate for capturing unmeasured spatial variation in the disease rate. Best et al (2000b) define the latent</font><font face="Arial" color="#0000FF" size="3"> </font><font face="Symbol" color="#000100" size="3">g</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>j </sub></font><font face="Arial" color="#000100" size="3">parameters on a 12 x 8 grid of approx 3km</font><font face="Arial" color="#000100" size="2"><sup>2</sup></font><font face="Arial" color="#000100" size="3"> quadrats covering the Huddersfield study region. k</font><font face="Arial" color="#000100" size="3"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> are then the elements of a 605 x 96 Gaussian kernel matrix, with <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="3">= 1 / (2</font><font face="Symbol" color="#000100" size="3">p r</font><font face="Arial" color="#000100" size="3"><sup>2</sup></font><font face="Arial" color="#000100" size="3">) exp(</font><font face="Symbol" color="#000100" size="3">-</font><font face="Arial" color="#000100" size="3">d</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"><sup>2</sup></font><font face="Arial" color="#000100" size="3"> / 2</font><font face="Symbol" color="#000100" size="3">r</font><font face="Arial" color="#000100" size="3"><sup>2</sup></font><font face="Arial" color="#000100" size="3">)<br>where d</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> represents the Euclidean distance between the centroid of area i of the study region and the location of the j</font><font face="Arial" color="#000100" size="3"><sup>th</sup></font><font face="Arial" color="#000100" size="3"> latent factor. Note that if the latent factors are defined on sub-regions rather than points, it is preferable to integrate the above kernel over the latent sub-region (i.e. over all possible distances between the centroid of area i and all locations within the latent sub-region) - the Splus / R function given below impelments this integration when computing the kernel matrix. </font><font face="Symbol" color="#000100" size="3">r </font><font face="Arial" color="#000100" size="3">&gt; 0 is a distance scale governing how rapidly the kernel weights (i.e. the influence of the j</font><font face="Arial" color="#000100" size="2"><sup>th</sup></font><font face="Arial" color="#000100" size="3"> latent factor on the disease risk in the i</font><font face="Arial" color="#000100" size="2"><sup>th</sup></font><font face="Arial" color="#000100" size="3"> area) decline with increasing distance. Best et al (2000b) fix </font><font face="Symbol" color="#000100" size="3">r </font><font face="Arial" color="#000100" size="3">= 1 km. By fixing </font><font face="Symbol" color="#000100" size="3">r</font><font face="Arial" color="#000100" size="3">, the kernel matrix can be pre-computed outside of WinBUGS (see link in the data file</font><font face="Arial" color="#0000FF" size="3"><u> </u></font><font face="Arial" color="#000100" size="3">for Splus / R code for doing this), thus simplifying the implementation. It is possible to treat </font><font face="Symbol" color="#000100" size="3">r</font><font face="Arial" color="#000100" size="3"> as uncertain (see </font><font face="Arial" color="#000000" size="3"><a href="../GeoBUGS/Examples/Forest.html"></font><font face="Arial" color="#0000FF" size="3"><u>Forest</u></font><font face="Arial" color="#000100" size="3"></a>), but this entails calculating the elements k</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> at each MCMC interation within the BUGS code: this leads to big increases in computation time for all but very small study regions and latent grids. (Note that since the overall scale parameter of the Gaussian kernel is common to all elements k</font><font face="Arial" color="#000100" size="2"><sub>ij</sub></font><font face="Arial" color="#000100" size="3"> it can be factored out of the externel calculation of the kernel, and included as an uncertain parameter (here called </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>2</sub></font><font face="Arial" color="#000100" size="3">) in the BUGS model.<br><br>Independent gamma prior distributions are assumed for the uncertainty quantities </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>0</sub></font><font face="Arial" color="#000100" size="3">, </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>1</sub></font><font face="Arial" color="#000100" size="3">, </font><font face="Symbol" color="#000100" size="3">b</font><font face="Arial" color="#000100" size="2"><sub>2</sub></font><font face="Arial" color="#000100" size="3"> and </font><font face="Symbol" color="#000100" size="3">g</font><font face="Symbol" color="#000100" size="2"> </font><font face="Arial" color="#000100" size="2"><sub>j</sub></font><font face="Arial" color="#000100" size="3"> as this enables the MCMC sampler to exploit conjugacy with the Poisson likelihood. <br><br>See Best et al (2000b) for full details and interpretation of the model, and </font><font face="Arial" color="#000000" size="3"><a href="../GeoBUGS/Manuals/Manual.html#Appendix 2"></font><font face="Arial" color="#0000FF" size="3"><u>Appendix&nbsp;2</u></font><font face="Arial" color="#000000" size="3"></a></font><font face="Arial" color="#000100" size="3"> for further technical information about the Poisson-gamma model. <br><br>The code for this model is given below.</font><font face="Arial" color="#0000FF" size="3"><br><br></font><font face="Arial" color="#0000FF" size="3"><strong>Model</strong></font><font face="Arial" color="#000100" size="3"><br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">model {<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Likelihood</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#FF0000" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">for (i in 1 : I) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># convolution likelihood: <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Y[i] ~ Poisson( sum_ j { mu[i, j] } )<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># where mu[i, j] = pop[i] * lambda[i, j] and<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># pop[i] = (standardised) population (in 100's) in area i<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># lambda[i, j] = disease rate in area i attributed to jth 'source', where<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># the sources include both observed and latent covariates.<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y[i] ~ dpois.conv(mu[i, ])&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="1"></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for (j in 1 : J) { <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># rescale kernel matrix<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k1[i, j] &lt;- ker[i, j] / prec<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</font><font face="Arial" color="#000100" size="3"> jth 'source' (jth latent spatial grid cell)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">lambda[i, j] &lt;- beta2 * gamma[j] * k1[i, j]</font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;}<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># (J+1)th 'source' (overall intercept; represents background rate)</font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">lambda[i,J+1] &lt;- beta0<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# (J+2)th 'source' (effect of observed NO2 covariate in area i)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">&nbsp;&nbsp;&nbsp;lambda[i,J+2] &lt;- beta1 * NO2[i]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># Note: if additional covariates have been measured, these <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># should be included in the same way as NO2, giving terms<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># lambda[i, J+3], lambda[i, J+4],.....etc. </font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for (j in 1 : J+2) { </font><font face="Arial" color="#000000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu[i, j] &lt;- lambda[i, j] * pop[i]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">}<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">}<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Priors</font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># See Table 22.1 in Best et al. (2000b) for further details.<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># Priors for latent spatial grid cell (gamma) parameters:<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Assume gamma_j ~ gamma(a, t) <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Prior shape parameter for gamma distn on gamma[j]'s will change in proportion to<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the size of the latent grid cells, to ensure aggregation consistency. The prior inverse<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# scale parameter for gamma distn on gamma[j]'s stays constant across different<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# partitions, but depends on the units used to measure the area of the latent grid cells:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# here we are assuming # 'area' is in sq kilometres, and we take tauG = 1 (per km^2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# which corresponds to assuming # that our prior guess at the value of the gamma[j]'s<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is based on 'observing' about 1 * (area of study region = 30*20km^2) = 600<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># 'prior points' over the study region. </font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note: area of latent grid cells is read in from data file<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alphaG &lt;- tauG * area<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tauG &lt;- 1 <br></font><font face="Arial" color="#000100" size="1"></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;for (j in 1 : J) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gamma[j] ~ dgamma(alphaG, tauG)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;}<br></font><font face="Arial" color="#000000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3"># Priors for beta coefficients:<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3">#<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Assume priors on each beta are of the form beta ~ gamma(a, t).<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3">#<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># Here, parameter of the prior are chosen by setting the prior mean to give an equal <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># number of cases allocated to each of the 3 'sources' (baseline, NO2 and latent), i.e.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# prior mean = a / t = a * 3 * Xbar / Ybar,<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># where Ybar is the overall disease rate in number of cases per unit population,<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># and Xbar is the </font><font face="Arial" color="#808080" size="3"><strong>population-weighted mean</strong></font><font face="Arial" color="#808080" size="3"> of covariate X. <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># We also take shape parameter a = 0.575, since this gives the ratio of the 90th : 10th<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#808080" size="3"># percentile of the prior distn = 100, which is suitably diffuse.<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;YBAR &lt;- sum(Y[])/sum(pop[])&nbsp;&nbsp;&nbsp;# mean number of cases per unit population<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;NO2BAR &lt;- inprod(NO2[], pop[]) / sum(pop[])&nbsp;&nbsp;&nbsp;# population-weighted mean NO2<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Shape parameter for Intercept (beta0)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alpha0&lt;- 0.575<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Inverse scale parameter for Intercept (beta0)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tau0 &lt;- 3 * alpha0 / YBAR<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Shape parameter for effect of NO2 (beta1)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alpha1&lt;- 0.575<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Inverse scale parameter for effect of NO2 (beta1)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tau1 &lt;- 3 * alpha1 * NO2BAR / YBAR<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Shape parameter for Latent coefficient (beta2)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;alpha2 &lt;- 0.575<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Inverse scale parameter for Latent coefficient (beta2)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;tau2 &lt;- 3 * alpha2&nbsp;&nbsp;&nbsp;/ YBAR<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;beta0 ~ dgamma(alpha0, tau0)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;beta1 ~ dgamma(alpha1, tau1)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;beta2 ~ dgamma(alpha2, tau2)<br><br></font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Summary quantities for posterior inference </font><font face="Arial" color="#FF0000" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#FF0000" size="3">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000000" size="3">for(i in 1:I) {<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Overall disease rate in area i <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RATE[i] &lt;- sum(mu[i, ])/pop[i]<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Rate associated with latent spatial factor in area i <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LATENT[i] &lt;- beta2 * inprod(k1[i,], gamma[])<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;}<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Expected rate (number of cases per unit population) attributed to each source <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># (see Table 22.2 in Best et al (2000b) )<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Background (overall baseline) rate per 100 population<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">rate.base &lt;- beta0<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Number of cases per 100 population attributed<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># to NO2 = beta1 * population-weighted mean value<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># of NO2 across the study region. <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;rate.no2 &lt;- beta1 * inprod(pop[], NO2[]) / sum(pop[])<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Number of cases per 100 population attributed to <br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># latent sources = beta2 * population-weighted mean<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># value of the latent spatial factor (sum_j k_ij gamma_j)<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;rate.latent &lt;- inprod(pop[], LATENT[]) / sum(pop[])<br></font><font face="Arial" color="#000100" size="1"></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># Percentage of cases attributed to each source:<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;Total &lt;- rate.base + rate.no2 + rate.latent </font><font face="Arial" color="#0000FF" size="3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3"># % cases attributed to baseline risk</font><font face="Arial" color="#0000FF" size="3"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">PC.base &lt;- rate.base / Total * 100<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# % cases attributed to NO2 exposure<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;PC.no2 &lt;- rate.no2 / Total * 100<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# % cases attributed to latent spatial factors<br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">&nbsp;&nbsp;&nbsp;PC.latent &lt;- rate.latent / Total * 100<br><br></font><font face="Arial" color="#000100" size="1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">}<br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#0000FF" size="3"><strong><u><a href="../GeoBUGS/Examples/Huddersfielddata.html">Data</a></u></strong></font><font face="Arial" color="#000000" size="2"> &nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">(Click to open)</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#0000FF" size="3"><strong><u><a href="../GeoBUGS/Examples/Huddersfieldinits.html">Inits&nbsp;for&nbsp;to&nbsp;chain&nbsp;1</a></u></strong></font><font face="Arial" color="#000000" size="2"><strong> &nbsp;&nbsp;&nbsp;</strong></font><font face="Arial" color="#0000FF" size="3"><strong><u><a href="../GeoBUGS/Examples/Huddersfieldinits1.html">Inits&nbsp;for&nbsp;to&nbsp;chain&nbsp;2</a></u></strong></font><font face="Arial" color="#000000" size="2">&nbsp;&nbsp;&nbsp;</font><font face="Arial" color="#000100" size="3">(Click to open)</font><font face="Arial" color="#000100" size="2"><br></font><font face="Arial" color="#000100" size="3"><br></font><font face="Arial" color="#000100" size="3">R / Splus functions</font><font face="Arial" color="#0000FF" size="3"> </font><font face="Arial" color="#0000FF" size="3"></font><font face="Arial" color="#0000FF" size="3"></font><font face="Arial" color="#0000FF" size="3"><u><a href="../GeoBUGS/Examples/HuddersfieldRcode.html">click&nbsp;here&nbsp;to&nbsp;open&nbsp;R&nbsp;&nbsp;Code</a></u></font><font face="Arial" color="#000000" size="2"> </font><font face="Arial" color="#000100" size="2"><br><br></font><font face="Arial" color="#0000FF" size="3"><strong>Results</strong></font><font face="Arial" color="#000100" size="2"><br><br>A 2000 iteration burn-in followed by a further 10000 updates gave the following results<br></font><font face="Arial" color="#000000" size="2">&nbsp;&nbsp;&nbsp;<center><br><img src="huddersfield1.bmp" alt="[huddersfield1]"><br></center></font><font face="Arial" color="#000100" size="3"><br>These differ slightly from those in Best et al (2000b) Table 22.2 since the data in this example have been randomly perturbed for confidentiality. However, the picture is broadly similar, with 1.84 (95% interval 0.046 to 4.2) cases per 100 population attributed to NO2 exposure, 7.75 (95% interval 4.2 to 10.0) cases per 100 population attributed to latent spatially varying risk factors and the remaining 0.39 (95% iterval 0.0019 to 3.4) cases per 100 population attributed to the (spatially constant) baseline risk. <br><br>Maps showing the posterior mean rate (per 100 population) of frequent cough attributed to the latent risk factors (cf Fig 22.6b in Best et al, 2000b) and the overall rate (per 100 population) of frequent cough in each area in the study region (cf Fig 22.7b in Best et al, 2000b) are show below. The relevant map file is available from the GeoBUGS 1.2 map tool and is called </font><font face="Arial" color="#000100" size="3"><strong><em>Huddersfield_750m_grid.<br><center><br></em></strong></font><font face="Arial" color="#000100" size="2"><strong><em><br><img src="huddersfield2.bmp" alt="[huddersfield2]"><br><br><img src="huddersfield3.bmp" alt="[huddersfield3]"><br></center></em></strong></font></p></body></html>